<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bid on <%= item.name %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .font-display { font-family: 'Fredoka One', cursive; }
        .font-body { font-family: 'Nunito', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 font-body text-gray-800 min-h-screen flex flex-col">

    <div class="container mx-auto px-4 py-8 flex-grow max-w-3xl">
        
        <a href="/" class="inline-block mb-6 text-gray-500 hover:text-black font-bold uppercase tracking-wider text-sm transition-colors">
            &larr; Back to Gallery
        </a>
        
        <div class="bg-white rounded-2xl overflow-hidden border-8 border-green-600 shadow-2xl">
            <img src="<%= item.image_url %>" alt="<%= item.name %>" class="w-full h-80 md:h-96 object-cover border-b-4 border-gray-100">
            
            <div class="p-8">
                <h1 class="text-4xl font-display mb-2 text-gray-900"><%= item.name %></h1>
                <p class="text-gray-600 mb-8 text-lg leading-relaxed"><%= item.description %></p>

                <div class="bg-gray-50 rounded-2xl p-6 mb-8 border border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <p class="text-sm text-gray-400 font-bold uppercase tracking-widest mb-1">Current Highest Bid</p>
                        <p class="text-5xl font-bold text-green-600 font-sans">$<%= Number(item.current_bid).toFixed(2) %></p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-400 font-bold uppercase tracking-widest mb-1">Held By</p>
                        <% if (item.bidder_name) { %>
                            <p class="text-xl font-bold text-gray-800"><%= item.bidder_name %></p>
                        <% } else { %>
                            <p class="text-xl font-bold text-gray-400 italic">No Bids Yet</p>
                        <% } %>
                    </div>
                </div>

                <% if (message) { %>
                    <div class="bg-yellow-100 border-l-8 border-yellow-500 text-yellow-800 p-4 mb-8 font-bold text-lg rounded-r-lg shadow-sm">
                        <%= message %>
                    </div>
                <% } %>

                <% if (isPaused) { %>
                    <div class="bg-red-100 border-4 border-red-500 text-red-800 p-6 rounded-xl text-center shadow-inner">
                        <h3 class="text-2xl font-display uppercase tracking-widest mb-2">Bidding Paused</h3>
                        <p class="font-bold">The auction is temporarily paused. No new bids can be placed right now.</p>
                    </div>
                <% } else { %>
                    <form action="/bid/<%= item.id %>" method="POST" class="space-y-6 bg-blue-50 p-6 rounded-2xl border-4 border-blue-100">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold uppercase tracking-wider mb-2">Full Name</label>
                                <input type="text" name="name" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 outline-none transition">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold uppercase tracking-wider mb-2">Email Address</label>
                                <input type="email" name="email" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 outline-none transition">
                            </div>
                        </div>

                        <div class="pt-4 border-t-2 border-blue-200">
                            <label class="block text-gray-700 text-sm font-bold uppercase tracking-wider mb-2">Bid Amount ($)</label>
                            <% 
                                let minInc = 0.25; let maxInc = 1.00;
                                if (item.bid_type === 2) { minInc = 0.50; maxInc = 5.00; }
                                else if (item.bid_type === 3) { minInc = 1.00; maxInc = 10.00; }
                                else if (item.bid_type === 4) { minInc = 1.00; maxInc = 25.00; }

                                const isFirstBid = !item.bidder_name;
                                const minBid = isFirstBid ? item.start_price : item.current_bid + minInc;
                                const maxBid = isFirstBid ? item.start_price + maxInc : item.current_bid + maxInc;
                            %>
                            <input type="number" step="0.01" name="amount" min="<%= minBid.toFixed(2) %>" max="<%= maxBid.toFixed(2) %>" required class="w-full px-4 py-4 border-4 border-gray-900 rounded-xl focus:border-yellow-400 outline-none font-sans font-bold text-3xl text-green-700 bg-gray-50" placeholder="e.g. <%= minBid.toFixed(2) %>">
                            <p class="text-xs text-blue-600 mt-2 font-bold uppercase tracking-wider">Must increase by at least $<%= minInc.toFixed(2) %>, max increase: $<%= maxInc.toFixed(2) %></p>
                        </div>
                        
                        <button type="submit" class="w-full bg-yellow-300 hover:bg-yellow-400 text-black font-bold tracking-widest text-2xl py-4 rounded-2xl transition duration-200 uppercase shadow-md active:scale-95">
                            Place Bid
                        </button>
                    </form>
                <% } %>
            </div>
        </div>
    </div>

    <footer class="bg-black text-white text-center py-4 font-display text-sm uppercase tracking-widest mt-auto">
        <p>Austin College Service Station</p>
    </footer>

    <script>
        const endsAt = parseInt("<%= typeof timerEndsAt !== 'undefined' ? timerEndsAt : 0 %>", 10);
        if (endsAt > Date.now()) {
            setInterval(() => {
                if (endsAt - Date.now() < 0) location.reload(); // Auto-refresh when time ends to lock the page
            }, 5000);
        }
    </script>
</body>
</html>